<!DOCTYPE html>
<html>
<head>
    <title>Patient Consult Summary Form</title>
    <style>
        .underline { text-decoration: underline; }
        .bold { font-weight: bold; }
        .italic { font-style: italic; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>Patient Consult Summary Form</h1>
    <form id="geneticForm">
        <label for="counselorName"><span class="bold">Name of Genetic Counselor:</span></label>
        <input type="text" id="counselorName" name="counselorName"><br><br>

        <label for="doctorName"><span class="bold">Name of Doctor:</span></label>
        <input type="text" id="doctorName" name="doctorName"><br><br>

        <label for="consultationTime"><span class="bold">Consultation Date & Time:</span></label>
        <input type="datetime-local" id="consultationTime" name="consultationTime"><br><br>
        
        <h2 class="underline">Patient Information</h2>

        <label for="patientName"><span class="bold">Name:</span></label>
        <input type="text" id="patientName" name="patientName"><br><br>

        <label for="patientDOB"><span class="bold">DOB:</span></label>
        <input type="date" id="patientDOB" name="patientDOB" onchange="calculateAge()"><br><br>

        <label for="patientSex"><span class="bold">Biological Sex:</span></label>
        <select id="patientSex" name="patientSex">
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select><br><br>

        <label for="genderIdentity"><span class="bold">Gender Identity:</span></label>
        <select id="genderIdentity" name="genderIdentity">
            <option value="Man">Man</option>
            <option value="Woman">Woman</option>
            <option value="Nonbinary">Nonbinary</option>
        </select><br><br>

        <h2 class="underline">Partner</h2>

        <label for="partnerName"><span class="bold">Name:</span></label>
        <input type="text" id="partnerName" name="partnerName"><br><br>

        <label for="partnerDOB"><span class="bold">DOB:</span></label>
        <input type="date" id="partnerDOB" name="partnerDOB" onchange="calculatePartnerAge()"><br><br>

        <label for="partnerSex"><span class="bold">Biological Sex:</span></label>
        <select id="partnerSex" name="partnerSex">
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select><br><br>

        <label for="partnerGenderIdentity"><span class="bold">Gender Identity:</span></label>
        <select id="partnerGenderIdentity" name="partnerGenderIdentity">
            <option value="Man">Man</option>
            <option value="Woman">Woman</option>
            <option value="Nonbinary">Nonbinary</option>
        </select><br><br>

        <h2 class="underline">Gamete Sources</h2>

        <label for="eggSource"><span class="bold">Egg Source:</span></label>
        <select id="eggSource" name="eggSource" onchange="toggleFreeText('eggSource')">
            <option value="Patient">Patient</option>
            <option value="Partner">Partner</option>
            <option value="Other">Other</option>
        </select>
        <input type="text" id="eggSourceOther" name="eggSourceOther" class="hidden" placeholder="Specify other"><br><br>

        <label for="eggState"><span class="bold">State of Egg:</span></label>
        <select id="eggState" name="eggState">
            <option value="Frozen">Frozen</option>
            <option value="Fresh">Fresh</option>
        </select><br><br>

        <label for="ageOfEgg"><span class="bold">Age of Egg:</span></label>
        <input type="number" id="ageOfEgg" name="ageOfEgg"><br><br>

        <label for="spermSource"><span class="bold">Sperm Source:</span></label>
        <select id="spermSource" name="spermSource" onchange="toggleFreeText('spermSource')">
            <option value="Patient">Patient</option>
            <option value="Partner">Partner</option>
            <option value="Other">Other</option>
        </select>
        <input type="text" id="spermSourceOther" name="spermSourceOther" class="hidden" placeholder="Specify other"><br><br>

        <h2 class="underline">PGTM Indication</h2>

        <label for="gene"><span class="bold">Gene:</span></label>
        <input type="text" id="gene" name="gene"><br><br>

        <label for="variant"><span class="bold">Variant:</span></label>
        <input type="text" id="variant" name="variant"><br><br>

        <label for="diseaseName"><span class="bold">Disease Name:</span></label>
        <input type="text" id="diseaseName" name="diseaseName"><br><br>

        <label for="carrier"><span class="bold">Carrier:</span></label>
        <select id="carrier" name="carrier">
            <option value="Egg source">Egg source</option>
            <option value="Sperm source">Sperm source</option>
            <option value="Egg and sperm source">Egg and sperm source</option>
        </select><br><br>

        <label for="inheritancePattern"><span class="bold">Inheritance Pattern:</span></label>
        <select id="inheritancePattern" name="inheritancePattern" onchange="toggleXLinkedText()">
            <option value="Autosomal dominant">Autosomal dominant</option>
            <option value="Autosomal recessive">Autosomal recessive</option>
            <option value="X-linked">X-linked</option>
        </select><br><br>

        <label for="additionalInformation"><span class="bold">Additional Information:</span></label>
        <input type="text" id="additionalInformation" name="additionalInformation"><br><br>

        <button type="button" onclick="submitForm()">Submit</button>
    </form>

    <div id="summaryOutput" style="border: 1px solid #ccc; padding: 10px; margin-top: 20px;"></div>

    <script>
        function toggleFreeText(selectId) {
            var selectElement = document.getElementById(selectId);
            var freeTextField = document.getElementById(selectId + 'Other');
            if (selectElement.value === 'Other') {
                freeTextField.classList.remove('hidden');
            } else {
                freeTextField.classList.add('hidden');
            }
        }

        function toggleXLinkedText() {
            var pattern = document.getElementById('inheritancePattern').value;
            var xLinkedText = document.getElementById('xLinkedText');
            if (pattern === 'X-linked') {
                if (!xLinkedText) {
                    var additionalText = document.createElement('div');
                    additionalText.id = 'xLinkedText';
                    additionalText.innerHTML = `
                        <p>We can stratify risk by embryo sex as well. Each chromosomally normal embryo screened for a <span class="italic">${document.getElementById('gene').value}</span> mutation has a:</p>
                        <ul>
                            <li>25% chance of being a <span class="italic">${document.getElementById('gene').value}</span>-negative male</li>
                            <li>25% chance of being a <span class="italic">${document.getElementById('gene').value}</span>-negative female</li>
                            <li>25% chance of being a <span class="italic">${document.getElementById('gene').value}</span>-positive male: This child is expected to have <span class="italic">${document.getElementById('diseaseName').value}</span>.</li>
                            <li>25% chance of being a <span class="italic">${document.getElementById('gene').value}</span>-positive female: Many <span class="italic">${document.getElementById('gene').value}</span>-positive females are asymptomatic due to X-linked inactivation, a natural process where one of the two X chromosomes in each cell is turned off and the other is left on. If the X chromosome with the mutated gene is turned on more than the one with the normal gene, the female might show symptoms of the condition. However, it is unpredictable which females will be symptomatic and to what extent. Most females with X-linked conditions remain asymptomatic.</li>
                        </ul>
                    `;
                    document.getElementById('summaryOutput').appendChild(additionalText);
                }
            } else {
                var xLinkedText = document.getElementById('xLinkedText');
                if (xLinkedText) {
                    xLinkedText.remove();
                }
            }
        }

        function submitForm() {
            var consultationDate = new Date(document.getElementById('consultationTime').value);
            var hours = consultationDate.getHours() % 12 === 0 ? 12 : consultationDate.getHours() % 12;
            var minutes = consultationDate.getMinutes() < 10 ? '0' + consultationDate.getMinutes() : consultationDate.getMinutes();
            var amPm = consultationDate.getHours() >= 12 ? 'pm' : 'am';
            var formattedDate = (consultationDate.getMonth() + 1) + '/' + consultationDate.getDate() + '/' + consultationDate.getFullYear() + ' ' + hours + ':' + minutes + amPm;
            
            var dob = new Date(document.getElementById('patientDOB').value);
            var formattedDOB = (dob.getMonth() + 1) + '/' + dob.getDate() + '/' + dob.getFullYear();
            
            var partnerDOB = new Date(document.getElementById('partnerDOB').value);
            var formattedPartnerDOB = (partnerDOB.getMonth() + 1) + '/' + partnerDOB.getDate() + '/' + partnerDOB.getFullYear();
            
            var eggState = document.getElementById('eggState').value;
            var ageOfEgg = document.getElementById('ageOfEgg').value;
            var carrier = document.getElementById('carrier').value;
            var gene = document.getElementById('gene').value;
            
            var output = "<h2 class='bold'>Patient Consult Summary</h2>";
            output += "<strong>Name of Genetic Counselor:</strong> " + document.getElementById('counselorName').value + "<br>";
            output += "<strong>Name of Doctor:</strong> " + document.getElementById('doctorName').value + "<br>";
            output += "<strong>Consultation Date & Time:</strong> " + formattedDate + "<br><br>";

            output += "<h3 class='underline'>Patient Information</h3>";
            output += "<span class='bold'>Name:</span> " + document.getElementById('patientName').value + "<br>";
            output += "<span class='bold'>DOB:</span> " + formattedDOB + "<br>";
            output += "<span class='bold'>Biological Sex:</span> " + document.getElementById('patientSex').value + "<br>";
            output += "<span class='bold'>Gender Identity:</span> " + document.getElementById('genderIdentity').value + "<br><br>";

            output += "<h3 class='underline'>Partner</h3>";
            output += "<span class='bold'>Name:</span> " + document.getElementById('partnerName').value + "<br>";
            output += "<span class='bold'>DOB:</span> " + formattedPartnerDOB + "<br>";
            output += "<span class='bold'>Biological Sex:</span> " + document.getElementById('partnerSex').value + "<br>";
            output += "<span class='bold'>Gender Identity:</span> " + document.getElementById('partnerGenderIdentity').value + "<br><br>";

            output += "<h3 class='underline'>Gamete Sources</h3>";
            output += "<span class='bold'>Egg Source:</span> " + document.getElementById('eggSource').value + 
                (document.getElementById('eggSource').value === 'Other' ? " - " + document.getElementById('eggSourceOther').value : "") + "<br>";
            output += "<span class='bold'>State of Egg:</span> " + document.getElementById('eggState').value + "<br>";
            output += "<span class='bold'>Age of Egg:</span> " + document.getElementById('ageOfEgg').value + "<br>";
            output += "<span class='bold'>Sperm Source:</span> " + document.getElementById('spermSource').value + 
                (document.getElementById('spermSource').value === 'Other' ? " - " + document.getElementById('spermSourceOther').value : "") + "<br><br>";

            output += "<h3 class='underline'>PGTM Indication</h3>";
            output += "<span class='bold'>Gene:</span> <span class='italic'>" + gene + "</span><br>";
            output += "<span class='bold'>Variant:</span> " + document.getElementById('variant').value + "<br>";
            output += "<span class='bold'>Disease Name:</span> " + document.getElementById('diseaseName').value + "<br>";
            output += "<span class='bold'>Carrier:</span> " + document.getElementById('carrier').value + "<br>";
            output += "<span class='bold'>Inheritance Pattern:</span> " + document.getElementById('inheritancePattern').value + "<br>";

            var additionalInfo = document.getElementById('additionalInformation').value;
            if (additionalInfo.trim()) {
                output += "<br>" + additionalInfo + "<br>";
            }

            output += "<h3 class='underline'>Embryo Genetic Testing Expectations</h3>";
            output += "<span>For each embryo created with " + eggState + " eggs from a " + ageOfEgg + " year old egg, there is a [chance]% chance that it will be chromosomally normal.</span><br>";
            output += "<span>For each embryo created from a " + carrier + " carrier, there is a [chance]% chance that it will be " + gene + "-negative.</span><br>";
            output += "<span>Overall, there is a [chance]% chance that every tested embryo is both chromosomally normal and " + gene + "-negative.</span><br><br>";

            document.getElementById('summaryOutput').innerHTML = output;

            // Toggle additional text for X-linked inheritance pattern
            toggleXLinkedText();
        }

        function calculateAge() {
            var dob = new Date(document.getElementById('patientDOB').value);
            var today = new Date();
            var age = today.getFullYear() - dob.getFullYear();
            var monthDifference = today.getMonth() - dob.getMonth();
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            document.getElementById('patientAge').value = age;
        }

        function calculatePartnerAge() {
            var dob = new Date(document.getElementById('partnerDOB').value);
            var today = new Date();
            var age = today.getFullYear() - dob.getFullYear();
            var monthDifference = today.getMonth() - dob.getMonth();
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            document.getElementById('partnerAge').value = age;
        }
    </script>
</body>
</html>
