<!DOCTYPE html>
<html>
<head>
    <title>Patient Consult Summary Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
        }
        .form-container {
            width: 100%;
            max-width: 800px;
            background-color: white;
            border: 2px solid #4b0082;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .form-section {
            display: none;
        }
        .form-section.active {
            display: block;
        }
        .bold { font-weight: bold; }
        .italic { font-style: italic; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; }
        .form-group input, .form-group select { width: 100%; padding: 8px; box-sizing: border-box; }
        h1, h2, button { color: #4b0082; }
        button { background-color: #4b0082; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; }
        button:hover { background-color: #3a006b; }
        .button-container { display: flex; justify-content: space-between; margin-top: 20px; }
        .header {
            background-color: #4b0082;
            color: white; /* Ensure the text is white */
            text-align: center;
            padding: 10px;
            border-radius: 10px 10px 0 0;
            margin: -20px -20px 20px -20px;
        }
        .hidden { display: none; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #4b0082;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #4b0082;
            color: white;
        }
    </style>
</head>
<body>
    <div class="form-container" id="formContainer">
        <div class="header">
            <h1>Patient Consult Summary: Genetic Counseling</h1>
        </div>
        <form id="geneticForm">
            <!-- Form Sections Here -->
            <div class="button-container">
                <button type="button" onclick="prevSection()">Previous</button>
                <button type="button" onclick="nextSection()">Next</button>
                <button type="button" onclick="submitForm()">Submit</button>
                <button type="button" class="hidden" onclick="backToForm()">Back to Form</button>
            </div>
        </form>
    </div>

    <div id="summaryOutput" style="border: 1px solid #4b0082; padding: 10px; font-family: 'Helvetica', sans-serif;" class="hidden">
        <!-- The summary output will be displayed here -->
    </div>

    <script>
        const sections = document.querySelectorAll('.form-section');
        let currentSectionIndex = 0;

        function showSection(index) {
            sections.forEach((section, i) => {
                section.classList.toggle('active', i === index);
            });
            document.querySelector('.button-container button[type="button"][onclick="prevSection()"]').style.display = index === 0 ? 'none' : 'inline-block';
            document.querySelector('.button-container button[type="button"][onclick="nextSection()"]').style.display = index === sections.length - 1 ? 'none' : 'inline-block';
            document.querySelector('.button-container button[type="button"][onclick="submitForm()"]').style.display = index === sections.length - 1 ? 'inline-block' : 'none';
        }

        function nextSection() {
            if (currentSectionIndex < sections.length - 1) {
                currentSectionIndex++;
                showSection(currentSectionIndex);
            }
        }

        function prevSection() {
            if (currentSectionIndex > 0) {
                currentSectionIndex--;
                showSection(currentSectionIndex);
            }
        }

        showSection(currentSectionIndex);

        function toggleFreeText(selectId) {
            var selectElement = document.getElementById(selectId);
            var freeTextField = document.getElementById(selectId + 'Other');
            if (selectElement.value === 'Other') {
                freeTextField.classList.remove('hidden');
            } else {
                freeTextField.classList.add('hidden');
            }
        }

        function toggleXLinkedText() {
            var pattern = document.getElementById('inheritancePattern').value;
            var xLinkedTextContainer = document.getElementById('knownFemaleCarrierFeaturesContainer');
            if (pattern === 'X-linked') {
                xLinkedTextContainer.classList.remove('hidden');
            } else {
                xLinkedTextContainer.classList.add('hidden');
            }
        }

        function submitForm() {
            // Hide the form
            document.getElementById('formContainer').classList.add('hidden');
            
            // Generate the summary output
            var consultationDate = new Date(document.getElementById('consultationTime').value);
            var hours = consultationDate.getHours() % 12 === 0 ? 12 : consultationDate.getHours() % 12;
            var minutes = consultationDate.getMinutes() < 10 ? '0' + consultationDate.getMinutes() : consultationDate.getMinutes();
            var amPm = consultationDate.getHours() >= 12 ? 'pm' : 'am';
            var formattedDate = (consultationDate.getMonth() + 1) + '/' + consultationDate.getDate() + '/' + consultationDate.getFullYear() + ' ' + hours + ':' + minutes + amPm;
            
            var dob = new Date(document.getElementById('patientDOB').value);
            var formattedDOB = (dob.getMonth() + 1) + '/' + dob.getDate() + '/' + dob.getFullYear();
            
            var partnerDOB = new Date(document.getElementById('partnerDOB').value);
            var formattedPartnerDOB = (partnerDOB.getMonth() + 1) + '/' + partnerDOB.getDate() + '/' + partnerDOB.getFullYear();
            
            var eggState = document.getElementById('eggState').value.toLowerCase();
            var ageOfEgg = document.getElementById('ageOfEgg').value;
            var positiveGameteSource = document.getElementById('positiveGameteSource').value;
            var gene = document.getElementById('gene').value;
            var inheritancePattern = document.getElementById('inheritancePattern').value;
            var knownFemaleCarrierFeatures = document.getElementById('knownFemaleCarrierFeatures').value.trim();
            
            var output = "<h2 class='bold'>Patient Consult Summary - Genetic Counseling</h2>";
            output += "<strong>Name of Genetic Counselor:</strong> " + document.getElementById('counselorName').value + "<br>";
            output += "<strong>Name of Doctor:</strong> " + document.getElementById('doctorName').value + "<br>";
            output += "<strong>Consultation Date & Time:</strong> " + formattedDate + "<br>";

            output += "<h3 class='underline'>Patient Information</h3>";
            output += "<span class='bold'>Name:</span> " + document.getElementById('patientName').value + "<br>";
            output += "<span class='bold'>DOB:</span> " + formattedDOB + "<br>";
            output += "<span class='bold'>Gamete Type:</span> " + document.getElementById('gameteType').value + "<br>";

            output += "<h3 class='underline'>Partner</h3>";
            output += "<span class='bold'>Name:</span> " + document.getElementById('partnerName').value + "<br>";
            output += "<span class='bold'>DOB:</span> " + formattedPartnerDOB + "<br>";
            output += "<span class='bold'>Gamete Type:</span> " + document.getElementById('partnerGameteType').value + "<br>";

            output += "<h3 class='underline'>Gamete Sources</h3>";
            output += "<span class='bold'>Egg Source:</span> " + document.getElementById('eggSource').value + 
                (document.getElementById('eggSource').value === 'Other' ? " - " + document.getElementById('eggSourceOther').value : "") + "<br>";
            output += "<span class='bold'>State of Egg:</span> " + eggState + "<br>";
            output += "<span class='bold'>Age of Egg:</span> " + ageOfEgg + "<br>";
            output += "<span class='bold'>Sperm Source:</span> " + document.getElementById('spermSource').value + 
                (document.getElementById('spermSource').value === 'Other' ? " - " + document.getElementById('spermSourceOther').value : "") + "<br>";

            output += "<h3 class='underline'>PGT-M Indication</h3>";
            output += "<span class='bold'>Gene:</span> <span class='italic'>" + gene + "</span><br>";
            output += "<span class='bold'>Variant(s):</span> " + document.getElementById('variants').value + "<br>";
            output += "<span class='bold'>Disease Name:</span> " + document.getElementById('diseaseName').value + "<br>";
            output += "<span class='bold'>Inheritance Pattern:</span> " + inheritancePattern + "<br>";
            output += "<span class='bold'>Positive Gamete Source(s):</span> " + positiveGameteSource + "<br>";

            if (inheritancePattern === 'X-linked') {
                output += "<p>In other words, each embryo has a:</p>";
                output += "<ul>";
                output += "<li>25% chance of being a chromosomally normal/<span class='italic'>" + gene + "</span>-negative male</li>";
                output += "<li>25% chance of being a chromosomally normal/<span class='italic'>" + gene + "</span>-negative female</li>";
                output += "<li>25% chance of being a chromosomally normal/<span class='italic'>" + gene + "</span>-positive male: This child is expected to have <span class='italic'>" + document.getElementById('diseaseName').value + "</span>.</li>";
                output += "<li>25% chance of being a chromosomally normal/<span class='italic'>" + gene + "</span>-positive female: Many <span class='italic'>" + gene + "</span>-positive females are asymptomatic due to X-linked inactivation, a natural process where one of the two X chromosomes in each cell is turned off and the other is left on. If the X chromosome with the mutated gene is turned on more than the one with the normal gene, the female might show symptoms of the condition. However, it is unpredictable which females will be symptomatic and to what extent. Most females with X-linked conditions remain asymptomatic.";
                if (knownFemaleCarrierFeatures) {
                    output += " Known Female Carrier Features: " + knownFemaleCarrierFeatures + ".";
                }
                output += "</li></ul>";
                output += "<p>On average, we recommend 2-3 embryos for each desired child.</p>";
            } else {
                output += "<p>On average, we recommend 2-3 embryos for each desired child.</p>";
            }

            // Add table for Partner Information
            output += `
                <h3>Partner Information Table</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Partner</th>
                            <th>Name</th>
                            <th>DOB</th>
                            <th>Gamete Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Partner</td>
                            <td>${document.getElementById('partnerName').value}</td>
                            <td>${formattedPartnerDOB}</td>
                            <td>${document.getElementById('partnerGameteType').value}</td>
                        </tr>
                    </tbody>
                </table>
            `;

            document.getElementById('summaryOutput').innerHTML = output;
            document.getElementById('summaryOutput').classList.remove('hidden');
            document.querySelector('.button-container button[onclick="backToForm()"]').classList.remove('hidden');
        }

        function calculateAge() {
            var dob = new Date(document.getElementById('patientDOB').value);
            var today = new Date();
            var age = today.getFullYear() - dob.getFullYear();
            var monthDifference = today.getMonth() - dob.getMonth();
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            document.getElementById('patientAge').value = age;
        }

        function calculatePartnerAge() {
            var dob = new Date(document.getElementById('partnerDOB').value);
            var today = new Date();
            var age = today.getFullYear() - dob.getFullYear();
            var monthDifference = today.getMonth() - dob.getMonth();
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            document.getElementById('partnerAge').value = age;
        }

        function backToForm() {
            document.getElementById('summaryOutput').classList.add('hidden');
            document.getElementById('formContainer').classList.remove('hidden');
            document.querySelector('.button-container button[onclick="backToForm()"]').classList.add('hidden');
        }
    </script>
</body>
</html>
